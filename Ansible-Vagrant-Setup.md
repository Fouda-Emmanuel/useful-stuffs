# Ansible Lab Setup Documentation - Complete Beginner's Guide

## What We Did and Why

### 🎯 Goal: Create a local Ansible lab that mimics AWS EC2 setup

**Why?** - To learn Ansible without AWS costs, using Vagrant to simulate real servers.

---

## Step 1: Setting Up Virtual Machines

### What We Did:
Created 4 virtual machines using Vagrant:
- **control** (Ubuntu) - Where Ansible runs from
- **web01** (CentOS) - Web server 1
- **web02** (CentOS) - Web server 2  
- **db01** (CentOS) - Database server

### Why?
This mimics a real company setup: one control machine managing multiple servers.

### Vagrantfile Used:
```ruby
Vagrant.configure("2") do |config|
  # CONTROL NODE (Ubuntu)
  config.vm.define "control" do |control|
    control.vm.box = "ubuntu/jammy64"
    control.vm.hostname = "control"
    control.vm.network "private_network", ip: "192.168.56.10"
  end

  # WEB01 (CentOS)
  config.vm.define "web01" do |web01|
    web01.vm.box = "centos/stream9"
    web01.vm.hostname = "web01"
    web01.vm.network "private_network", ip: "192.168.56.11"
  end

  # WEB02 (CentOS)
  config.vm.define "web02" do |web02|
    web02.vm.box = "centos/stream9"
    web02.vm.hostname = "web02"
    web02.vm.network "private_network", ip: "192.168.56.12"
  end

  # DB01 (CentOS)
  config.vm.define "db01" do |db01|
    db01.vm.box = "centos/stream9"
    db01.vm.hostname = "db01"
    db01.vm.network "private_network", ip: "192.168.56.13"
  end
end
```

⚠️ **IMPORTANT NOTE About Private Network IPs**

**What these IPs mean:**
The private IPs (192.168.56.10–13) allow your VMs to communicate with your computer (host) **without using your home or office network**. Think of it as a mini-network between your computer and your VMs only.

**Do these IPs work for everyone?**
Not always! It depends on your host machine’s existing VirtualBox host-only network. Each computer may have a different range (192.168.56.x, 192.168.33.x, 192.168.10.x, etc.). Don’t worry about adapter numbers like `#2`, `#3`, `#4` — only the **IP of the adapter** matters.

**How to check your host-only network range:**

```bash
VBoxManage list hostonlyifs
```

Look for the line with `IPAddress`. For example:

```
IPAddress: 192.168.56.1  ← This determines your IP range
```

**How to choose VM IPs:**

* If your host adapter is `192.168.56.1` → use `192.168.56.10-13`
* If your host adapter is `192.168.33.1` → use `192.168.33.10-13`
* If your host adapter is `192.168.10.1` → use `192.168.10.10-13`

💡 **Tip:** Always start VM IPs at `.10` or higher to avoid conflicts with your host adapter.

**Beginner-friendly alternative (recommended): Use DHCP**
Let Vagrant assign IPs automatically. This avoids conflicts:

```ruby
config.vm.network "private_network", type: "dhcp"
```

After `vagrant up`, check the assigned IPs:

```bash
vagrant ssh control 
ip addr show
```

**Why DHCP is safer for beginners:**

* Guarantees your VMs will always get an IP that matches your host’s network.
* You don’t need to manually check or edit ranges.
* Prevents “IP already in use” errors.

**Commands to Start Your Lab:**

```bash
vagrant up          # Start all VMs
vagrant status      # Check VM status
```

✅ **Key Takeaways :**

* Private IPs allow your VMs to talk to each other and your computer.
* Static IPs are convenient but may conflict with your host; always check your host-only network range.
* DHCP is the safest option for beginners.
* Always verify your VM IPs before adding them to Ansible inventory.


---

## Step 2: Installing Ansible

### What We Did:
Installed Ansible only on the control node.

### Why?
Ansible is agentless - it runs commands from one central machine (control) to manage others.

### Commands (run on control node):
```bash
sudo apt update
sudo apt install software-properties-common
sudo add-apt-repository --yes --update ppa:ansible/ansible
sudo apt install ansible
ansible --version   # Verify installation
```

---

## Step 3: Understanding SSH Keys - CRITICAL CONCEPT

### 🚨 Problem We Faced: SSH Key Confusion

**What are SSH Keys?**
- **Private Key**: Your password (keep secret)
- **Public Key**: Lock that matches your private key (put on servers)

**In Our Lab:**
- Each VM has its own private key generated by Vagrant
- These are different from AWS .pem files but work the same way

### Key Locations (Vagrant):
**Note: `.vagrant/machines/<replace-with-your-vm>/virtualbox/private_key`

```
.vagrant/machines/control/virtualbox/private_key
.vagrant/machines/web01/virtualbox/private_key  
.vagrant/machines/web02/virtualbox/private_key
.vagrant/machines/db01/virtualbox/private_key
```

---

## Step 4: Creating Ansible Inventory File

### What We Did:
Created a file telling Ansible about our servers.

### Why?
Ansible needs to know: Which servers to manage? How to connect to them?

### First Attempt (WRONG - Got Empty Host Error):
```bash
ansible web01 -m ping
# ERROR: provided hosts list is empty
```

### 🚨 Problem: Ansible couldn't find our inventory file

### Solution 1: Specify inventory file every time
```bash
ansible web01 -m ping -i inventory
```

### Solution 2: Create ansible.cfg to set default inventory

### Final Inventory File (inventory):
```yaml
all:
  children:
    webservers:
      hosts:
        web01:
          ansible_host: 192.168.56.11
          ansible_user: vagrant
          ansible_ssh_private_key_file: ./web01-key.pem
        web02:
          ansible_host: 192.168.56.12
          ansible_user: vagrant
          ansible_ssh_private_key_file: ./web02-key.pem
    dbservers:
      hosts:
        db01:
          ansible_host: 192.168.56.13
          ansible_user: vagrant
          ansible_ssh_private_key_file: ./db01-key.pem
```

---

## Step 5: Setting Up SSH Keys in Project

### What We Did:
Copied Vagrant's private keys to our project folder.

### Why?
- Keep keys organized in our project
- Mimic AWS style where you download .pem files
- Avoid long complicated paths

### Commands (from Windows host):
```bash
cat "C:/Users/DELL LATITUDE 7280/vagrant-vms/ansible-lab/.vagrant/machines/web01/virtualbox/private_key" > web01-key.pem
cat "C:/Users/DELL LATITUDE 7280/vagrant-vms/ansible-lab/.vagrant/machines/web02/virtualbox/private_key" > web02-key.pem
cat "C:/Users/DELL LATITUDE 7280/vagrant-vms/ansible-lab/.vagrant/machines/db01/virtualbox/private_key" > db01-key.pem
```

### 🚨 CRITICAL ERROR: File Permissions Too Open
```bash
ansible web01 -m ping -i inventory
# ERROR: Permissions 0664 for './web01-key.pem' are too open
# This private key will be ignored
```

### Why This Happened:
SSH requires private keys to be readable ONLY by you for security.

### Solution:
```bash
chmod 400 *.pem
```
This makes files: `-r--------` (only you can read/write)

---

## Step 6: Solving Host Key Verification

### 🚨 Problem: SSH Fingerprint Prompt
```
The authenticity of host '192.168.56.11' can't be established.
Are you sure you want to continue connecting (yes/no)?
```

### Why This Happens:
- SSH is checking if the server is genuine (security feature)
- In labs, this breaks automation because Ansible can't type "yes"

### Solution: Disable host key checking

### ansible.cfg File: change this section we when to the /etc/ansible/ansible_cfg then we renamed it to /etc/ansible/ansible_cfg_backup then we generated the ansible_cfg and we just modiify the host key checking to false
```ini
[defaults]
inventory = ./inventory
host_key_checking = False
private_key_file = ./control-key.pem
remote_user = vagrant
```

### What This Does:
- `inventory = ./inventory` - Use our inventory file automatically
- `host_key_checking = False` - Don't ask "are you sure?" for new servers
- `private_key_file` - Default key if not specified per host
- `remote_user` - Default user to connect as

---

## Step 7: Testing Everything Works

### Final Test Commands:
```bash
# Test individual servers
ansible web01 -m ping
ansible web02 -m ping  
ansible db01 -m ping

# Test groups
ansible webservers -m ping
ansible dbservers -m ping

# Test all servers
ansible all -m ping
```

### ✅ Expected Success Output:
```
web01 | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
```

---

---

## 📁 Final Project Structure
```
ansible-lab/
├── Vagrantfile          # VM definitions
├── ansible.cfg          # Ansible configuration
├── inventory            # Server list (YAML format)
├── control-key.pem      # SSH key for control node
├── web01-key.pem        # SSH key for web01
├── web02-key.pem        # SSH key for web02
└── db01-key.pem         # SSH key for db01
```

## 🎯 Key Lessons Learned

1. **Ansible is agentless** - runs from one control machine
2. **Inventory file** tells Ansible about your servers
3. **SSH keys must have correct permissions** (`chmod 600`)
4. **Host key checking** should be disabled in labs
5. **Vagrant private keys** work like AWS .pem files
6. **Groups in inventory** (webservers, dbservers) help organize

## 🚀 You're Now Ready To:
- Write Ansible playbooks
- Automate software installation
- Configure multiple servers at once
- Learn real DevOps skills!

This lab gives you the exact same experience as working with real cloud servers, but completely free and local!
